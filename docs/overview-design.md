# Claude Code Web UI - æ¦‚è¦è¨­è¨ˆæ›¸

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ç›®çš„
Claude Code CLIã®æ©Ÿèƒ½ã‚’Web UIã¨ã—ã¦æä¾›ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç°¡å˜ã«AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

### 1.2 ä¸»è¦æ©Ÿèƒ½
- **ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: ChatGPTé¢¨ã®UIã§Claude Codeã¨å¯¾è©±
- **ãƒãƒ£ãƒƒãƒˆå±¥æ­´ç®¡ç†**: ä¼šè©±å±¥æ­´ã®ä¿å­˜ãƒ»æ¤œç´¢ãƒ»å†é–‹
- **è¨­å®šç®¡ç†**: MCPã€Skillsã€Subagentã€ãƒ„ãƒ¼ãƒ«ã®GUIè¨­å®š
- **ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œ**: å®‰å…¨ãªç’°å¢ƒã§ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
- **Dockerå¯¾å¿œ**: ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ |
|---------|------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Next.js 15 (App Router), React 19, Tailwind CSS, shadcn/ui |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Next.js API Routes, Claude Agent SDK |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | SQLite + Prisma ORM |
| èªè¨¼ | Claude Code CLI ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ |
| ã‚³ãƒ³ãƒ†ãƒŠ | Docker, Docker Compose |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Docker Container                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Next.js Application                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   Frontend      â”‚    â”‚      API Routes             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   (React)       â”‚â—„â”€â”€â–ºâ”‚   /api/chat                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚   /api/sessions             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Chat UI      â”‚    â”‚   /api/settings             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Settings     â”‚    â”‚   /api/mcp                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - History      â”‚    â”‚   /api/tools                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                         â”‚                 â”‚   â”‚
â”‚  â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚                         â”‚   Claude Agent SDK            â”‚ â”‚   â”‚
â”‚  â”‚                         â”‚   @anthropic-ai/claude-agent  â”‚ â”‚   â”‚
â”‚  â”‚                         â”‚   -sdk v0.1.76                â”‚ â”‚   â”‚
â”‚  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                         â”‚                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   SQLite DB     â”‚â—„â”€â”€â–ºâ”‚   Claude Code CLI            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   (Prisma)      â”‚    â”‚   (Runtime)                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Volume Mounts:                                                  â”‚
â”‚  - ~/.claude (èªè¨¼æƒ…å ±)                                          â”‚
â”‚  - ./data (SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)                                   â”‚
â”‚  - ./workspace (ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
src/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (chat)/                   # ãƒãƒ£ãƒƒãƒˆé–¢é€£ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ [sessionId]/          # ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¥ãƒšãƒ¼ã‚¸
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ settings/                 # è¨­å®šãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ page.tsx              # è¨­å®šãƒ¡ã‚¤ãƒ³
â”‚   â”‚   â”œâ”€â”€ mcp/                  # MCPè¨­å®š
â”‚   â”‚   â”œâ”€â”€ tools/                # ãƒ„ãƒ¼ãƒ«è¨­å®š
â”‚   â”‚   â”œâ”€â”€ agents/               # Subagentè¨­å®š
â”‚   â”‚   â””â”€â”€ skills/               # Skillsè¨­å®š
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”œâ”€â”€ chat/                 # ãƒãƒ£ãƒƒãƒˆAPI
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ sessions/             # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ settings/             # è¨­å®šAPI
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ mcp/                  # MCPç®¡ç†API
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â””â”€â”€ tools/                # ãƒ„ãƒ¼ãƒ«ç®¡ç†API
â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ layout.tsx                # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â””â”€â”€ globals.css               # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”œâ”€â”€ components/                   # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/                       # shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ chat/                     # ãƒãƒ£ãƒƒãƒˆé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â”œâ”€â”€ MessageItem.tsx
â”‚   â”‚   â”œâ”€â”€ InputArea.tsx
â”‚   â”‚   â””â”€â”€ ToolOutput.tsx
â”‚   â”œâ”€â”€ sidebar/                  # ã‚µã‚¤ãƒ‰ãƒãƒ¼é–¢é€£
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ SessionList.tsx
â”‚   â”‚   â””â”€â”€ SessionItem.tsx
â”‚   â””â”€â”€ settings/                 # è¨­å®šé–¢é€£
â”‚       â”œâ”€â”€ MCPConfig.tsx
â”‚       â”œâ”€â”€ ToolsConfig.tsx
â”‚       â”œâ”€â”€ AgentsConfig.tsx
â”‚       â””â”€â”€ SkillsConfig.tsx
â”œâ”€â”€ lib/                          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ claude/                   # Claude SDKé–¢é€£
â”‚   â”‚   â”œâ”€â”€ client.ts             # SDKã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ session.ts            # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â””â”€â”€ types.ts              # å‹å®šç¾©
â”‚   â”œâ”€â”€ db/                       # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ prisma.ts             # Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ queries.ts            # ã‚¯ã‚¨ãƒªé–¢æ•°
â”‚   â””â”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”œâ”€â”€ hooks/                        # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useChat.ts
â”‚   â”œâ”€â”€ useSession.ts
â”‚   â””â”€â”€ useSettings.ts
â””â”€â”€ types/                        # å‹å®šç¾©
    â”œâ”€â”€ chat.ts
    â”œâ”€â”€ session.ts
    â””â”€â”€ settings.ts
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 3.1 ERå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Session        â”‚     â”‚      Message        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚â”€â”€â”€â”€<â”‚ id (PK)             â”‚
â”‚ title               â”‚     â”‚ sessionId (FK)      â”‚
â”‚ claudeSessionId     â”‚     â”‚ role                â”‚
â”‚ createdAt           â”‚     â”‚ content             â”‚
â”‚ updatedAt           â”‚     â”‚ toolCalls           â”‚
â”‚ settings            â”‚     â”‚ metadata            â”‚
â”‚ isArchived          â”‚     â”‚ createdAt           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MCPServer        â”‚     â”‚      Agent          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚     â”‚ id (PK)             â”‚
â”‚ name                â”‚     â”‚ name                â”‚
â”‚ type                â”‚     â”‚ description         â”‚
â”‚ command             â”‚     â”‚ prompt              â”‚
â”‚ args                â”‚     â”‚ tools               â”‚
â”‚ env                 â”‚     â”‚ model               â”‚
â”‚ isEnabled           â”‚     â”‚ isEnabled           â”‚
â”‚ createdAt           â”‚     â”‚ createdAt           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Settings        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚
â”‚ key                 â”‚
â”‚ value               â”‚
â”‚ updatedAt           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Prismaã‚¹ã‚­ãƒ¼ãƒ

```prisma
model Session {
  id              String    @id @default(cuid())
  title           String
  claudeSessionId String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  settings        Json?
  isArchived      Boolean   @default(false)
  messages        Message[]
}

model Message {
  id        String   @id @default(cuid())
  sessionId String
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  role      String   // 'user' | 'assistant' | 'system'
  content   String
  toolCalls Json?
  metadata  Json?
  createdAt DateTime @default(now())
}

model MCPServer {
  id        String   @id @default(cuid())
  name      String   @unique
  type      String   // 'stdio' | 'sse' | 'http'
  command   String?
  args      Json?
  env       Json?
  url       String?
  headers   Json?
  isEnabled Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Agent {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  prompt      String
  tools       Json?
  model       String?
  isEnabled   Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model Settings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
}
```

---

## 4. ä¸»è¦æ©Ÿèƒ½ãƒ•ãƒ­ãƒ¼

### 4.1 ãƒãƒ£ãƒƒãƒˆé€ä¿¡ãƒ•ãƒ­ãƒ¼

```
User Input â†’ API Route â†’ Claude Agent SDK â†’ Claude Code CLI â†’ Response Stream
     â†“                                                              â†“
   UI Update â† WebSocket/SSE â† Message Processing â† SDK Messages â†â”€â”˜
     â†“
   DB Save (Message)
```

### 4.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ•ãƒ­ãƒ¼

```
æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ:
1. User clicks "New Chat"
2. Frontend creates new session in DB
3. Claude Agent SDK query starts fresh
4. session_id from SDK stored in Session.claudeSessionId

ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹:
1. User selects existing session
2. Load messages from DB for display
3. Use SDK's resume option with claudeSessionId
4. Continue conversation with full context
```

### 4.3 MCPè¨­å®šãƒ•ãƒ­ãƒ¼

```
MCP Serverè¿½åŠ :
1. User fills MCP form (name, type, command/url, args, env)
2. Save to MCPServer table
3. Next chat will include new MCP in mcpServers option
4. SDK connects to MCP server on query start
```

---

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 5.1 èªè¨¼
- Claude Code CLI ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³èªè¨¼ã‚’åˆ©ç”¨
- `~/.claude` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’Dockerã«ãƒã‚¦ãƒ³ãƒˆã—ã¦èªè¨¼æƒ…å ±ã‚’å…±æœ‰
- åˆå›èµ·å‹•æ™‚ã«èªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’æ¡ˆå†…

### 5.2 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
- Claude Agent SDKã®`sandbox`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã¯æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ¶é™
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã¯è¨­å®šã§åˆ¶å¾¡å¯èƒ½

### 5.3 å…¥åŠ›æ¤œè¨¼
- ã™ã¹ã¦ã®APIå…¥åŠ›ã‚’Zodã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³é˜²æ­¢ï¼ˆPrisma ORMä½¿ç”¨ï¼‰
- XSSé˜²æ­¢ï¼ˆReactè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— + DOMPurifyï¼‰

---

## 6. Dockeræ§‹æˆ

### 6.1 Dockerfileæ¦‚è¦

```dockerfile
FROM node:20-alpine AS base

# Claude Code CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN npm install -g @anthropic-ai/claude-code

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
FROM base AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³
FROM base AS runner
WORKDIR /app
ENV NODE_ENV=production
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/public ./public
EXPOSE 3000
CMD ["node", "server.js"]
```

### 6.2 ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆ

| ãƒ›ã‚¹ãƒˆãƒ‘ã‚¹ | ã‚³ãƒ³ãƒ†ãƒŠãƒ‘ã‚¹ | ç”¨é€” |
|-----------|-------------|------|
| `~/.claude` | `/root/.claude` | Claudeèªè¨¼æƒ…å ± |
| `./data` | `/app/data` | SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| `./workspace` | `/app/workspace` | ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |

---

## 7. å®Ÿè£…çŠ¶æ³

### 7.1 å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ âœ…

#### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»åŸºç›¤
| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | å‚™è€ƒ |
|------|---------|------|
| Next.js 16 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ | `package.json`, `next.config.ts` | App Router, Turbopackå¯¾å¿œ |
| Prisma 7 + SQLite | `prisma/schema.prisma`, `src/lib/db/prisma.ts` | better-sqlite3ã‚¢ãƒ€ãƒ—ã‚¿ä½¿ç”¨ |
| å‹å®šç¾© | `src/types/index.ts` | Session, Message, ChatEventç­‰ |
| shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | `src/components/ui/*` | Button, Input, ScrollAreaç­‰ |
| Dockerå¯¾å¿œ | `Dockerfile`, `docker-compose.yml` | ~/.claude ãƒã‚¦ãƒ³ãƒˆå¯¾å¿œ |

#### ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | å‚™è€ƒ |
|------|---------|------|
| ãƒãƒ£ãƒƒãƒˆUI | `src/components/chat/*` | ChatGPTé¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ | `src/app/api/chat/route.ts` | SSEã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ |
| ãƒãƒ£ãƒƒãƒˆå±¥æ­´è¡¨ç¤º | `src/hooks/useChat.ts` | React Queryä½¿ç”¨ |
| ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `src/app/api/chat/route.ts` | Server-Sent Events |
| ç”Ÿæˆä¸­æ­¢æ©Ÿèƒ½ | `src/hooks/useChat.ts` | AbortControllerä½¿ç”¨ |

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | å‚™è€ƒ |
|------|---------|------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§è¡¨ç¤º | `src/components/sidebar/Sidebar.tsx` | ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¡¨ç¤º |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ | `src/app/api/sessions/route.ts` | æ–°è¦ãƒãƒ£ãƒƒãƒˆé–‹å§‹æ™‚ã«è‡ªå‹•ä½œæˆ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°å–å¾— | `src/app/api/sessions/[id]/route.ts` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å«ã‚€ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤ | `src/app/api/sessions/[id]/route.ts` | CASCADEå‰Šé™¤ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ›¿ | `src/hooks/useChat.ts` | staleTime:0ã§å¸¸ã«æœ€æ–°å–å¾— |

#### Claude Agent SDKçµ±åˆ
| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | å‚™è€ƒ |
|------|---------|------|
| SDKæ¥ç¶š | `src/app/api/chat/route.ts` | @anthropic-ai/claude-agent-sdk v0.1.76 |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹ | `src/app/api/chat/route.ts` | claudeSessionIdä½¿ç”¨ |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† | `src/app/api/chat/route.ts` | ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŠ½å‡º |

#### ãã®ä»–
| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | å‚™è€ƒ |
|------|---------|------|
| UUIDç”Ÿæˆ | `src/lib/utils/uuid.ts` | ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ã |
| React Queryè¨­å®š | `src/components/providers/QueryProvider.tsx` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç† |
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | `src/app/(chat)/page.tsx`, `src/app/(chat)/[sessionId]/page.tsx` | App Router |

#### è¨­å®šæ©Ÿèƒ½
| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ« | å‚™è€ƒ |
|------|---------|------|
| æ¨©é™ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UI | `src/components/chat/PermissionModeSelector.tsx` | ãƒãƒ£ãƒƒãƒˆå…¥åŠ›æ¬„ä¸Šéƒ¨ã§å³æ™‚åˆ‡æ›¿ |
| è¨­å®šç”»é¢ | `src/app/settings/page.tsx` | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ãƒ¢ãƒ¼ãƒ‰è¨­å®š |
| è¨­å®šAPI | `src/app/api/settings/route.ts` | GET/PUTå¯¾å¿œ |
| è¨­å®šãƒ•ãƒƒã‚¯ | `src/hooks/useSettings.ts` | React Queryä½¿ç”¨ |

---

### 7.2 æœªå®Ÿè£…æ©Ÿèƒ½ âŒ

#### è¨­å®šUI
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ |
|------|--------|------|
| MCPè¨­å®šUI | é«˜ | ã‚µãƒ¼ãƒãƒ¼è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ |
| ãƒ„ãƒ¼ãƒ«è¨­å®šUI | é«˜ | è¨±å¯/ç¦æ­¢ãƒ„ãƒ¼ãƒ«ã®è¨­å®š |
| Subagentè¨­å®šUI | ä¸­ | ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾© |
| Skillsè¨­å®šUI | ä¸­ | ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰è¨­å®š |
| æ¨©é™ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UI | é«˜ | **å®Ÿè£…æ¸ˆã¿** â†’ [è©³ç´°è¨­è¨ˆæ›¸ 11ç« ](./detailed-design.md#11-æ¨©é™ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿uiè¨­è¨ˆ) |
| ä¸€èˆ¬è¨­å®šUI | ä¸­ | ãƒ†ãƒ¼ãƒã€è¨€èªã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ« |

#### ãƒãƒ£ãƒƒãƒˆæ‹¡å¼µ
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ |
|------|--------|------|
| ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œç¢ºèªUI | é«˜ | **è¨­è¨ˆæ¸ˆã¿** â†’ [è©³ç´°è¨­è¨ˆæ›¸ 12ç« ](./detailed-design.md#12-ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œç¢ºèªuiè¨­è¨ˆ) |
| ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœè¡¨ç¤º | é«˜ | toolCalls ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¡¨ç¤º |
| Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° | é«˜ | ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€ãƒªã‚¹ãƒˆç­‰ |
| ã‚·ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º | ä¸­ | Claudeæ€è€ƒéç¨‹ã®è¡¨ç¤º |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | ä¸­ | ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ |
| ç”Ÿæˆä¸­æ­¢ã®Claudeå´åæ˜  | ä¸­ | SDK abortæ©Ÿèƒ½ |

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³æ‹¡å¼µ
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ |
|------|--------|------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œç´¢ | ä¸­ | ã‚¿ã‚¤ãƒˆãƒ«ãƒ»å†…å®¹æ¤œç´¢ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– | ä½ | éè¡¨ç¤ºåŒ– |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›† | ä¸­ | æ‰‹å‹•ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | ä½ | JSON/Markdownå‡ºåŠ› |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¤ãƒ³ãƒãƒ¼ãƒˆ | ä½ | å±¥æ­´å¾©å…ƒ |

#### UI/UX
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ |
|------|--------|------|
| ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ | ä¸­ | ãƒ†ãƒ¼ãƒåˆ‡æ›¿ |
| ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ | ä¸­ | ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ |
| ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ | ä½ | Ctrl+Enterç­‰ |
| ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ | ä¸­ | æ“ä½œãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ |
| ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚±ãƒ«ãƒˆãƒ³ | ä½ | èª­è¾¼ä¸­è¡¨ç¤º |

#### APIæ‹¡å¼µ
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ |
|------|--------|------|
| MCPç®¡ç†API | é«˜ | GET/POST/PATCH/DELETE /api/mcp |
| ãƒ„ãƒ¼ãƒ«ç®¡ç†API | é«˜ | GET/PUT /api/tools |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†API | ä¸­ | GET/POST/PATCH/DELETE /api/agents |
| è¨­å®šAPI | ä¸­ | GET/PUT /api/settings |
| å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | ä¸­ | Zodã‚¹ã‚­ãƒ¼ãƒ |

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å“è³ª
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å‚™è€ƒ |
|------|--------|------|
| å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚º | é«˜ | XSSå¯¾ç­– |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | ä¸­ | APIä¿è­· |
| ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª | ä¸­ | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼å‡¦ç† |
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | ä½ | Vitest |
| E2Eãƒ†ã‚¹ãƒˆ | ä½ | Playwright |

---

### 7.3 é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

#### Phase 1: åŸºæœ¬æ©Ÿèƒ½ âœ… å®Œäº†
- [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [x] ãƒãƒ£ãƒƒãƒˆUIå®Ÿè£…
- [x] Claude Agent SDKçµ±åˆ
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- [x] Dockerå¯¾å¿œ

#### Phase 2: è¨­å®šæ©Ÿèƒ½ ğŸš§ é€²è¡Œä¸­
- [x] æ¨©é™ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UI âœ…
- [ ] MCPè¨­å®šUI
- [ ] ãƒ„ãƒ¼ãƒ«è¨­å®šUI
- [ ] Subagentè¨­å®šUI
- [ ] Skillsè¨­å®šUI

#### Phase 3: ãƒãƒ£ãƒƒãƒˆæ‹¡å¼µ
- [ ] Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- [ ] ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœè¡¨ç¤º
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- [ ] ã‚·ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º

#### Phase 4: UI/UXæ”¹å–„
- [ ] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- [ ] ãƒãƒ£ãƒƒãƒˆå±¥æ­´æ¤œç´¢
- [ ] ã‚¨ãƒ©ãƒ¼é€šçŸ¥æ”¹å–„

#### Phase 5: å“è³ªãƒ»æœ€é©åŒ–
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ 
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

---

## 8. å‚è€ƒè³‡æ–™

- [Claude Agent SDK TypeScript Reference](https://platform.claude.com/docs/en/api/agent-sdk/typescript)
- [Claude Agent SDK Overview](https://platform.claude.com/docs/en/api/agent-sdk/overview)
- [Next.js Documentation](https://nextjs.org/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [shadcn/ui Components](https://ui.shadcn.com)
